min_version: 1.10.0
pre-commit:
  jobs:
    - name: Check Secrets
      group:
        parallel: true
        jobs:
          - name: gitleaks
            run: mise x -- gitleaks git --no-banner --pre-commit --redact --staged --verbose

          - name: ripsecrets
            run: mise x -- ripsecrets --strict-ignore {staged_files}

    - name: Linting
      group:
        parallel: true
        jobs:
          - name: ruff
            run: mise x -- ruff check --fix {staged_files}
            glob: ['*.py']
            exclude: symlink_*
            stage_fixed: true

    - name: Formatting
      group:
        parallel: true
        jobs:
          - name: prettier
            run: mise x -- bunx prettier --write --cache --ignore-unknown {staged_files}
            glob:
              - '*.code-snippets'
              - '*.css'
              - '*.html'
              - '*.json'
              - '*.jsonc'
              - '*.md'
              - '*.plist{,.tmpl}'
              - '*.rb'
              - '*.sublime-syntax'
              - '*.xml{,.tmpl}'
              - '*.yaml{,.tmpl}'
              - '*.yml{,.tmpl}'
              - Brewfile{,.tmpl}
              - Gemfile
              - Rakefile
            exclude:
              - pnpm-lock.yaml
              - schemas/vendor/**
              - symlink_*
            stage_fixed: true

          - name: fish_indent
            run: fish_indent -w {staged_files}
            glob: ['*.fish', '*.fish.tmpl']
            exclude: symlink_*
            stage_fixed: true

          - name: ruff
            run: mise x -- ruff format {staged_files}
            glob: ['*.py']
            exclude: symlink_*
            stage_fixed: true

          - name: stylua
            run: mise x -- stylua --respect-ignores {staged_files}
            glob: ['*.lua']
            exclude: symlink_*
            stage_fixed: true

          - name: taplo
            run: mise x -- taplo format {staged_files}
            glob: ['*.toml']
            exclude: symlink_*
            stage_fixed: true

pre-push:
  parallel: true
  commands:
    ripsecrets:
      run: mise x -- ripsecrets --strict-ignore {push_files}
